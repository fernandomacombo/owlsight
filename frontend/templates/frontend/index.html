{% load static %}
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#070707" />

  <link rel="icon" type="image/x-icon" href="{% static 'frontend/images/favicon.ico' %}">
  <link rel="apple-touch-icon" href="{% static 'frontend/images/favicon.ico' %}">
  <script src="https://cdn.tailwindcss.com"></script>

  <title>Owlsight ‚Äî Biblioteca</title>

  <style>
    :root{
      --bg:#070707;
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --stroke: rgba(255,255,255,.10);
      --red:#E10600;
      --red2:#8A0000;
    }

    html,body{ height:100%; background:var(--bg); color:var(--text); }
    body{ overflow-x:hidden; }

    /* ====== NAV ====== */
    .nav-glass{
      background: linear-gradient(180deg, rgba(0,0,0,.70), rgba(0,0,0,.15));
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }

    /* ====== HERO (Netflix banner) ====== */
    .hero{
      position: relative;
      height: 100vh;           /* ocupa toda tela */
      min-height: 640px;
      display: grid;
      align-items: end;
    }
    @media (max-width: 640px){
      .hero{ min-height: 720px; }
    }

    .hero-bg{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 15% 10%, rgba(225,6,0,.25), transparent 60%),
        radial-gradient(700px 420px at 85% 15%, rgba(138,0,0,.20), transparent 60%),
        #070707;
      overflow:hidden;
    }
    .hero-bg img{
      width:100%; height:100%;
      object-fit: cover;
      opacity:.55;
      filter: saturate(1.08) contrast(1.08);
      transform: scale(1.04);
      animation: slowZoom 10s ease-in-out infinite alternate;
    }
    @keyframes slowZoom{
      from{ transform: scale(1.04) translateY(0); }
      to{ transform: scale(1.10) translateY(1%); }
    }

    /* Gradientes Netflix */
    .hero-shade{
      position:absolute; inset:0;
      background:
        linear-gradient(90deg, rgba(7,7,7,.95) 0%, rgba(7,7,7,.55) 45%, rgba(7,7,7,.08) 100%),
        linear-gradient(180deg, rgba(7,7,7,.12) 0%, rgba(7,7,7,.85) 80%, rgba(7,7,7,1) 100%);
    }

    /* ====== BUTTONS ====== */
    .btn-red{
      background: linear-gradient(135deg, var(--red), var(--red2));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
    }
    .btn-ghost{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* ====== ROWS ====== */
    .row{
      display:flex;
      gap: 14px;
      overflow-x:auto;
      padding-bottom: 12px;
      scroll-snap-type: x mandatory;
    }
    .row::-webkit-scrollbar{ height: 10px; }
    .row::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.14); border-radius: 999px; }
    .row::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); border-radius: 999px; }

    .card{
      width: 180px;
      flex: 0 0 auto;
      scroll-snap-align: start;
      position: relative;
      transform: translateZ(0);
      transition: transform .18s ease;
    }
    @media (min-width: 640px){ .card{ width: 210px; } }
    @media (min-width: 1024px){ .card{ width: 230px; } }

    .poster{
      height: 280px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .poster img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
    }

    .card:hover{ transform: scale(1.08); z-index: 30; }
    .info{
      position:absolute;
      left:0; right:0;
      bottom:-10px;
      transform: translateY(16px);
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
      padding: 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.85);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 20px 60px rgba(0,0,0,.65);
      pointer-events:none;
    }
    .card:hover .info{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    .clamp-2{
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    /* ====== small subtle motion ====== */
    .fade-up{
      animation: fadeUp .6s ease both;
    }
    @keyframes fadeUp{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>

<body>

  <!-- NAV -->
  <header class="fixed top-0 left-0 right-0 z-50 nav-glass">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-[72px] flex items-center justify-between">
      <!-- Logo livre -->
      <a href="{% url 'frontend:home' %}" class="flex items-center gap-3">
        <img src="{% static 'frontend/images/logo.png' %}" alt="Owlsight"
             class="h-10 w-auto object-contain"
             onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;color:white;font-weight:900;font-size:20px&quot;>Owlsight</span>';">
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm text-white/80">
        <a href="#mais-lidos" class="hover:text-white">Mais lidos</a>
        <a href="#mais-recentes" class="hover:text-white">Mais recentes</a>
        <a href="#todos" class="hover:text-white">Todos</a>

        {% if user.is_authenticated %}
          <a href="{% url 'frontend:favorites' %}" class="hover:text-white">Favoritos</a>
          <a href="{% url 'frontend:account' %}" class="hover:text-white">Minha conta</a>
          {% if user.is_staff or user.is_superuser %}
            <a href="/admin/" class="hover:text-white">Admin</a>
          {% endif %}
          <form method="post" action="{% url 'frontend:logout' %}">
            {% csrf_token %}
            <button class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/15 border border-white/10">Sair</button>
          </form>
        {% else %}
          <a href="{% url 'frontend:login' %}" class="hover:text-white">Login</a>
          <a href="{% url 'frontend:register' %}" class="px-3 py-2 rounded-lg btn-red font-semibold">Criar conta</a>
        {% endif %}
      </nav>

      <button id="menuBtn" class="md:hidden px-3 py-2 rounded-lg bg-white/10 border border-white/10">
        ‚ò∞
      </button>
    </div>

    <div id="mobileMenu" class="hidden md:hidden border-t border-white/10 bg-black/80">
      <div class="mx-auto max-w-7xl px-4 py-3 grid gap-2 text-sm">
        <a href="#mais-lidos" class="py-2">Mais lidos</a>
        <a href="#mais-recentes" class="py-2">Mais recentes</a>
        <a href="#todos" class="py-2">Todos</a>

        {% if user.is_authenticated %}
          <a href="{% url 'frontend:favorites' %}" class="py-2">Favoritos</a>
          <a href="{% url 'frontend:account' %}" class="py-2">Minha conta</a>
          {% if user.is_staff or user.is_superuser %}
            <a href="/admin/" class="py-2">Admin</a>
          {% endif %}
          <form method="post" action="{% url 'frontend:logout' %}">
            {% csrf_token %}
            <button class="w-full text-left py-2">Sair</button>
          </form>
        {% else %}
          <a href="{% url 'frontend:login' %}" class="py-2">Login</a>
          <a href="{% url 'frontend:register' %}" class="py-2">Criar conta</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-bg">
      {% if featured and featured.cover %}
        <img src="{{ featured.cover.url }}" alt="{{ featured.title }}">
      {% else %}
        <!-- fallback sem quebrar -->
        <img src="{% static 'frontend/images/hero_fallback.jpg' %}" alt="Owlsight">
      {% endif %}
    </div>
    <div class="hero-shade"></div>

    <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-12">
      <div class="max-w-2xl fade-up">
        <div class="text-xs text-white/70">
          {% if featured %}
            {% if featured.book_type == "premium" %}üíé Premium{% else %}üéÅ Free{% endif %}
            {% if featured.genre %} ‚Ä¢ {{ featured.genre }}{% endif %}
          {% else %}
            Biblioteca inteligente
          {% endif %}
        </div>

        <h1 class="mt-3 text-4xl sm:text-5xl lg:text-6xl font-black tracking-tight">
          {% if featured %}{{ featured.title }}{% else %}Owlsight{% endif %}
        </h1>

        <p class="mt-4 text-white/70 text-base sm:text-lg clamp-2">
          {% if featured and featured.description %}
            {{ featured.description }}
          {% else %}
            Explore livros em um layout cinematogr√°fico e moderno ‚Äî estilo Netflix.
          {% endif %}
        </p>

        <div class="mt-6 flex flex-col sm:flex-row gap-3">
          {% if featured %}
            <a href="{% url 'frontend:read' featured.id 1 %}"
               class="px-6 py-3 rounded-lg font-bold btn-red text-center">
              ‚ñ∂ Ler agora
            </a>
          {% else %}
            <a href="/admin/"
               class="px-6 py-3 rounded-lg font-bold btn-red text-center">
              Abrir Admin
            </a>
          {% endif %}

          <a href="#todos"
             class="px-6 py-3 rounded-lg font-semibold btn-ghost text-center">
            ‚ìò Ver cat√°logo
          </a>
        </div>

        <div class="mt-4 text-xs text-white/45">
          Livros no banco: {{ db_books_count|default:"0" }}
        </div>
      </div>
    </div>
  </section>

  <!-- CONTENT -->
  <main class="relative -mt-10 pb-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

      <!-- ROW: MOST READ -->
      <section id="mais-lidos" class="pt-10">
        <div class="flex items-center justify-between">
          <h2 class="text-xl sm:text-2xl font-black">Mais lidos</h2>
          <a href="#todos" class="text-sm text-white/60 hover:text-white">Ver todos ‚Üí</a>
        </div>

        <div class="row mt-4">
          {% for b in most_read %}
            <article class="card">
              <div class="poster">
                {% if b.cover %}
                  <img src="{{ b.cover.url }}" alt="{{ b.title }}">
                {% else %}
                  <div class="h-full grid place-items-center text-4xl">üìò</div>
                {% endif %}
              </div>

              <div class="info">
                <div class="text-sm font-extrabold clamp-2">{{ b.title }}</div>
                <div class="text-xs text-white/70 mt-1">
                  {{ b.author|default:"" }}{% if b.genre %} ‚Ä¢ {{ b.genre }}{% endif %}
                </div>
                <p class="text-xs text-white/70 mt-2 clamp-2">
                  {{ b.description|default:""|truncatechars:120 }}
                </p>
                <div class="mt-3 flex gap-2">
                  <a href="{% url 'frontend:read' b.id 1 %}" class="flex-1 px-3 py-2 rounded-lg btn-red text-center text-sm font-semibold">
                    Ler
                  </a>
                  <a href="{% url 'frontend:login' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">
                    ‚ô°
                  </a>
                </div>
              </div>
            </article>
          {% empty %}
            <div class="text-white/60 text-sm">Ainda n√£o h√° livros.</div>
          {% endfor %}
        </div>
      </section>

      <!-- ROW: MOST RECENT -->
      <section id="mais-recentes" class="pt-10">
        <div class="flex items-center justify-between">
          <h2 class="text-xl sm:text-2xl font-black">Mais recentes</h2>
          <a href="#todos" class="text-sm text-white/60 hover:text-white">Ver todos ‚Üí</a>
        </div>

        <div class="row mt-4">
          {% for b in most_recent %}
            <article class="card">
              <div class="poster">
                {% if b.cover %}
                  <img src="{{ b.cover.url }}" alt="{{ b.title }}">
                {% else %}
                  <div class="h-full grid place-items-center text-4xl">üÜï</div>
                {% endif %}
              </div>

              <div class="info">
                <div class="text-sm font-extrabold clamp-2">{{ b.title }}</div>
                <div class="text-xs text-white/70 mt-1">
                  {{ b.author|default:"" }}{% if b.genre %} ‚Ä¢ {{ b.genre }}{% endif %}
                </div>
                <p class="text-xs text-white/70 mt-2 clamp-2">
                  {{ b.description|default:""|truncatechars:120 }}
                </p>
                <div class="mt-3 flex gap-2">
                  <a href="{% url 'frontend:read' b.id 1 %}" class="flex-1 px-3 py-2 rounded-lg btn-red text-center text-sm font-semibold">
                    Ler
                  </a>
                  <a href="{% url 'frontend:login' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">
                    ‚ô°
                  </a>
                </div>
              </div>
            </article>
          {% empty %}
            <div class="text-white/60 text-sm">Sem livros recentes.</div>
          {% endfor %}
        </div>
      </section>

      <!-- GRID: ALL -->
      <section id="todos" class="pt-12">
        <div class="flex items-end justify-between gap-4">
          <div>
            <h2 class="text-xl sm:text-2xl font-black">Todos os livros</h2>
            <p class="text-sm text-white/60 mt-1">Cat√°logo vindo do banco de dados.</p>
          </div>
        </div>

        <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-5 gap-4">
          {% for b in books %}
            <article class="rounded-2xl overflow-hidden border border-white/10 bg-white/5 hover:scale-[1.02] transition">
              <div class="h-44 bg-black/40">
                {% if b.cover %}
                  <img src="{{ b.cover.url }}" alt="{{ b.title }}" class="w-full h-full object-cover">
                {% else %}
                  <div class="h-full grid place-items-center text-4xl">üìó</div>
                {% endif %}
              </div>

              <div class="p-3">
                <div class="font-bold text-sm clamp-2">{{ b.title }}</div>
                <div class="text-xs text-white/60 mt-1">
                  {{ b.author|default:"" }}{% if b.genre %} ‚Ä¢ {{ b.genre }}{% endif %}
                </div>
                <div class="mt-3 flex gap-2">
                  <a href="{% url 'frontend:read' b.id 1 %}" class="flex-1 px-3 py-2 rounded-lg btn-red text-center text-sm font-semibold">
                    Ler
                  </a>
                  <a href="{% url 'frontend:login' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">
                    ‚ô°
                  </a>
                </div>
              </div>
            </article>
          {% empty %}
            <div class="col-span-full text-white/60 text-sm">Nenhum livro encontrado.</div>
          {% endfor %}
        </div>
      </section>

      <footer class="pt-14 text-center text-xs text-white/40">
        Owlsight v1.0 ‚Äî Todos direitos reservados
      </footer>
    </div>
  </main>

  <script>
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    if(menuBtn && mobileMenu){
      menuBtn.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));
    }
  </script>
</body>
</html>