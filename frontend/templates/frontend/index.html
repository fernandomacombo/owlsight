{% load static %}
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#070707" />

  <link rel="icon" type="image/x-icon" href="{% static 'frontend/images/favicon.ico' %}">
  <link rel="apple-touch-icon" href="{% static 'frontend/images/favicon.ico' %}">
  <script src="https://cdn.tailwindcss.com"></script>

  <title>Owlsight â€” Biblioteca</title>

  <style>
    :root{
      --bg:#070707;
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --stroke: rgba(255,255,255,.10);
      --red:#E10600;
      --red2:#8A0000;
      --panel: rgba(0,0,0,.55);
      --gold: #f5c15b;
    }

    html,body{ height:100%; background:var(--bg); color:var(--text); }
    body{ overflow-x:hidden; }

    .nav{
      position:fixed; top:0; left:0; right:0; z-index:50;
      background: linear-gradient(180deg, rgba(0,0,0,.86), rgba(0,0,0,.25));
      border-bottom: 1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .nav-link{
      color: rgba(255,255,255,.74);
      transition: color .15s ease, transform .15s ease;
    }
    .nav-link:hover{ color: rgba(255,255,255,.95); transform: translateY(-1px); }

    .btn-red{
      background: linear-gradient(135deg,var(--red),var(--red2));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
    }
    .btn-ghost{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .chip{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      padding: 6px 12px;
    }

    .hero{
      min-height: 100vh;
      position: relative;
      display:flex;
      align-items: center;
      padding-top: 84px;
    }

    .hero-bg{
      position:absolute; inset:0;
      overflow:hidden;
      background:#050505;
    }
    .hero-bg .bg-img{
      position:absolute; inset:-2%;
      width:104%; height:104%;
      object-fit: cover;
      filter: blur(10px) saturate(1.15) contrast(1.05);
      opacity:.36;
      transform: scale(1.12);
      animation: slowMove 10s ease-in-out infinite alternate;
    }
    @keyframes slowMove{
      from{ transform: scale(1.12) translateY(0px); }
      to  { transform: scale(1.18) translateY(10px); }
    }

    .hero-shade{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 78% 35%, rgba(225,6,0,.20), transparent 60%),
        radial-gradient(700px 420px at 18% 18%, rgba(138,0,0,.18), transparent 60%),
        linear-gradient(90deg, rgba(7,7,7,.96) 0%, rgba(7,7,7,.70) 48%, rgba(7,7,7,.12) 100%),
        linear-gradient(180deg, rgba(7,7,7,.20) 0%, rgba(7,7,7,.96) 88%, rgba(7,7,7,1) 100%);
    }

    .fade-up{ animation: fadeUp .55s ease both; }
    @keyframes fadeUp{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .stat{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      border-radius: 16px;
      padding: 10px 12px;
    }

    .book-wrap{
      position: relative;
      width: min(430px, 82vw);
      aspect-ratio: 3/4;
      transform: translateZ(0);
      filter: drop-shadow(0 30px 70px rgba(0,0,0,.75));
    }
    .book{
      width:100%; height:100%;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      transform: perspective(900px) rotateY(-14deg) rotateX(2deg);
      animation: bookFloat 4.8s ease-in-out infinite;
      position: relative;
    }
    @keyframes bookFloat{
      0%,100%{ transform: perspective(900px) rotateY(-14deg) rotateX(2deg) translateY(0); }
      50%{ transform: perspective(900px) rotateY(-12deg) rotateX(1deg) translateY(-10px); }
    }
    .book img{ width:100%; height:100%; object-fit: cover; display:block; }
    .book:after{
      content:"";
      position:absolute; inset:-35% -50%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent);
      transform: rotate(12deg);
      animation: shine 2.8s ease-in-out infinite;
      pointer-events:none;
      opacity:.25;
    }
    @keyframes shine{
      from{ transform: translateX(-28%) rotate(12deg); }
      to  { transform: translateX(28%) rotate(12deg); }
    }

    .row{
      display:flex;
      gap: 14px;
      overflow-x:auto;
      padding: 8px 2px 14px;
      scroll-snap-type: x mandatory;
    }
    .row::-webkit-scrollbar{ height: 10px; }
    .row::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.14); border-radius: 999px; }
    .row::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); border-radius: 999px; }

    .tile{
      width: 180px;
      flex: 0 0 auto;
      scroll-snap-align: start;
      position: relative;
      transform: translateZ(0);
      transition: transform .18s ease;
    }
    @media (min-width:640px){ .tile{ width: 210px; } }
    @media (min-width:1024px){ .tile{ width: 230px; } }

    .poster{
      height: 300px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      position: relative;
    }
    .poster img{ width:100%; height:100%; object-fit: cover; display:block; }

    .badge{
      position:absolute; top:10px; left:10px;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .tile:hover{ transform: scale(1.10); z-index: 30; }
    .tile-info{
      position:absolute; left:0; right:0; bottom:-8px;
      transform: translateY(16px);
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
      padding: 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.86);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 20px 60px rgba(0,0,0,.65);
    }
    .tile:hover .tile-info{ opacity:1; transform: translateY(0); }

    .clamp-2{
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .progress{
      height: 7px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
    }
    .progress > span{
      display:block;
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--red), rgba(225,6,0,.65));
    }

    .premium-strip{
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 480px at 85% 50%, rgba(225,6,0,.26), transparent 60%),
        rgba(255,255,255,.04);
      border-radius: 18px;
      overflow:hidden;
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>

<body>

  <header class="nav">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-[72px] flex items-center justify-between">
      <a href="{% url 'frontend:home' %}" class="flex items-center gap-3">
        <img src="{% static 'frontend/images/logo.png' %}" alt="Owlsight"
             class="h-9 w-auto object-contain"
             onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;color:white;font-weight:900;font-size:20px&quot;>Owlsight</span>';">
      </a>

      <nav class="hidden md:flex items-center gap-7 text-sm">
        <a class="nav-link" href="{% url 'frontend:home' %}">InÃ­cio</a>
        <a class="nav-link" href="#explorar">Explorar</a>

        {% if user.is_authenticated %}
          <a class="nav-link" href="{% url 'frontend:favorites' %}">Favoritos</a>
          <a class="nav-link" href="{% url 'frontend:categories' %}">Categorias</a>
          <a class="nav-link" href="{% url 'frontend:account' %}">Minha biblioteca</a>
        {% else %}
          <a class="nav-link" href="{% url 'frontend:login' %}">Minha biblioteca</a>
        {% endif %}

        <a class="nav-link" href="#premium">Premium</a>
      </nav>

      <div class="hidden md:flex items-center gap-3">
        <a href="#premium" class="px-4 py-2 rounded-lg btn-red font-semibold">Upgrade</a>

        {% if user.is_authenticated %}
          <a href="{% url 'frontend:account' %}" class="flex items-center gap-2 px-2 py-2 rounded-lg bg-white/5 border border-white/10">
            <div class="w-8 h-8 rounded-full bg-white/10 grid place-items-center text-xs">ğŸ‘¤</div>
            <span class="text-sm text-white/80 hidden lg:inline">{{ user.username|default:"Conta" }}</span>
            <span class="text-white/60">â–¾</span>
          </a>
        {% else %}
          <a href="{% url 'frontend:login' %}" class="px-4 py-2 rounded-lg bg-white/10 border border-white/10">Login</a>
        {% endif %}
      </div>

      <button id="menuBtn" class="md:hidden px-3 py-2 rounded-lg bg-white/10 border border-white/10">â˜°</button>
    </div>

    <div id="mobileMenu" class="hidden md:hidden border-t border-white/10 bg-black/80">
      <div class="mx-auto max-w-7xl px-4 py-3 grid gap-2 text-sm">
        <a href="{% url 'frontend:home' %}" class="py-2">InÃ­cio</a>
        <a href="#explorar" class="py-2">Explorar</a>
        <a href="#premium" class="py-2">Premium</a>

        {% if user.is_authenticated %}
          <a href="{% url 'frontend:favorites' %}" class="py-2">Favoritos</a>
          <a href="{% url 'frontend:categories' %}" class="py-2">Categorias</a>
          <a href="{% url 'frontend:account' %}" class="py-2">Minha biblioteca</a>
        {% else %}
          <a href="{% url 'frontend:login' %}" class="py-2">Minha biblioteca</a>
          <a href="{% url 'frontend:login' %}" class="py-2">Login</a>
          <a href="{% url 'frontend:register' %}" class="py-2">Criar conta</a>
        {% endif %}
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="hero-bg">
      {% if featured and featured.cover %}
        <img class="bg-img" src="{{ featured.cover.url }}" alt="{{ featured.title }}">
      {% else %}
        <img class="bg-img" src="{% static 'frontend/images/hero_fallback.jpg' %}" alt="Owlsight">
      {% endif %}
    </div>
    <div class="hero-shade"></div>

    <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 w-full">
      <div class="grid lg:grid-cols-2 gap-10 items-center">
        <div class="fade-up max-w-2xl">
          <div class="flex flex-wrap gap-2 text-xs text-white/80">
            <span class="chip">ğŸ¬ Cinematic</span>
            <span class="chip">âš¡ RÃ¡pido</span>
            <span class="chip">ğŸ”’ Seguro</span>
            {% if featured and featured.book_type == "premium" %}
              <span class="chip">ğŸ’ Premium</span>
            {% else %}
              <span class="chip">ğŸ Free</span>
            {% endif %}
          </div>

          <div class="mt-4 text-sm text-white/70">
            {% if featured %}
              {{ featured.author|default:"" }}
              {% if featured.genre %} â€¢ {{ featured.genre }}{% endif %}
              {% if featured.release_year %} â€¢ {{ featured.release_year }}{% endif %}
            {% else %}
              Biblioteca inteligente â€” estilo cinema
            {% endif %}
          </div>

          <h1 class="mt-4 text-4xl sm:text-5xl lg:text-6xl font-black tracking-tight">
            {% if featured %}{{ featured.title }}{% else %}Owlsight{% endif %}
          </h1>

          <p class="mt-4 text-white/70 text-base sm:text-lg clamp-2">
            {% if featured and featured.description %}
              {{ featured.description }}
            {% else %}
              Explore livros com recomendaÃ§Ãµes, progresso e favoritos â€” com um visual cinematogrÃ¡fico.
            {% endif %}
          </p>

          <div class="mt-5 grid grid-cols-3 gap-3">
            <div class="stat">
              <div class="text-xs text-white/50">AvaliaÃ§Ã£o</div>
              <div class="mt-1 font-extrabold">
                <span style="color:var(--gold)">â˜…</span>
                {{ featured.rating|default:"4.8" }}
                <span class="text-xs text-white/50">/5</span>
              </div>
            </div>
            <div class="stat">
              <div class="text-xs text-white/50">Tipo</div>
              <div class="mt-1 font-extrabold">
                {% if featured and featured.book_type == "premium" %}ğŸ’ Premium{% else %}ğŸ Free{% endif %}
              </div>
            </div>
            <div class="stat">
              <div class="text-xs text-white/50">PÃ¡ginas</div>
              <div class="mt-1 font-extrabold">ğŸ“„ {{ featured.total_pages|default:"â€”" }}</div>
            </div>
          </div>

          <div class="mt-6 flex flex-col sm:flex-row gap-3">
            {% if featured %}
              <a href="{% url 'frontend:read' featured.id 1 %}" class="px-6 py-3 rounded-lg btn-red font-bold text-center">
                â–¶ Ler Agora
              </a>
              <a href="#explorar" class="px-6 py-3 rounded-lg btn-ghost font-semibold text-center">
                â“˜ Explorar catÃ¡logo
              </a>
              {% if user.is_authenticated %}
                <a href="{% url 'frontend:favorites' %}" class="px-6 py-3 rounded-lg bg-white/10 border border-white/10 font-semibold text-center">
                  â™¡ Favoritar
                </a>
              {% else %}
                <a href="{% url 'frontend:login' %}" class="px-6 py-3 rounded-lg bg-white/10 border border-white/10 font-semibold text-center">
                  â™¡ Favoritar
                </a>
              {% endif %}
            {% else %}
              <a href="/admin/" class="px-6 py-3 rounded-lg btn-red font-bold text-center">Adicionar Livros</a>
              <a href="#explorar" class="px-6 py-3 rounded-lg btn-ghost font-semibold text-center">Explorar</a>
            {% endif %}
          </div>

          <div class="mt-4 text-xs text-white/45">
            Livros no banco: {{ db_books_count|default:"0" }}
          </div>
        </div>

        <div class="hidden lg:flex justify-end">
          <div class="book-wrap fade-up">
            <div class="book">
              {% if featured and featured.cover %}
                <img src="{{ featured.cover.url }}" alt="{{ featured.title }}">
              {% else %}
                <div class="w-full h-full grid place-items-center text-6xl bg-white/5">ğŸ“•</div>
              {% endif %}
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <main id="explorar" class="relative -mt-10 pb-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

      {% if user.is_authenticated %}
      <section class="pt-10">
        <div class="flex items-center justify-between">
          <h2 class="text-xl sm:text-2xl font-black">Continue lendo</h2>
          <a href="{% url 'frontend:account' %}" class="text-sm text-white/60 hover:text-white">Ver progresso â†’</a>
        </div>

        <div class="row mt-4">
          {% for item in continue_reading %}
            {% with b=item.book|default:item %}
            <article class="tile">
              <div class="poster">
                {% if b.cover %}<img src="{{ b.cover.url }}" alt="{{ b.title }}">{% else %}
                  <div class="h-full grid place-items-center text-4xl">ğŸ“–</div>
                {% endif %}
                <span class="badge">â³ {{ item.progress|default:"0" }}%</span>
              </div>

              <div class="tile-info">
                <div class="text-sm font-extrabold clamp-2">{{ b.title }}</div>
                <div class="text-xs text-white/70 mt-1">{{ b.author|default:"" }}</div>

                <div class="mt-2 progress">
                  <span style="width: {{ item.progress|default:'0' }}%;"></span>
                </div>

                <div class="mt-3 flex gap-2">
                  <a href="{% url 'frontend:read' b.id 1 %}" class="flex-1 px-3 py-2 rounded-lg btn-red text-center text-sm font-semibold">Continuar</a>
                  <a href="{% url 'frontend:favorites' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">â™¡</a>
                </div>
              </div>
            </article>
            {% endwith %}
          {% empty %}
            <div class="text-white/60 text-sm">Sem progresso ainda. Comece a ler um livro ğŸ™‚</div>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      <section class="pt-10">
        <div class="flex items-center justify-between">
          <h2 class="text-xl sm:text-2xl font-black">Recomendados para vocÃª</h2>
          <a href="#todos" class="text-sm text-white/60 hover:text-white">Ver tudo â†’</a>
        </div>

        <div class="row mt-4">
          {% for b in recommended %}
            <article class="tile">
              <div class="poster">
                {% if b.cover %}
                  <img src="{{ b.cover.url }}" alt="{{ b.title }}">
                {% else %}
                  <div class="h-full grid place-items-center text-4xl">ğŸ“˜</div>
                {% endif %}
                {% if b.book_type == "premium" %}
                  <span class="badge">ğŸ’ Premium</span>
                {% else %}
                  <span class="badge">ğŸ Free</span>
                {% endif %}
              </div>

              <div class="tile-info">
                <div class="text-sm font-extrabold clamp-2">{{ b.title }}</div>
                <div class="text-xs text-white/70 mt-1">
                  {{ b.author|default:"" }}{% if b.genre %} â€¢ {{ b.genre }}{% endif %}
                </div>

                <div class="mt-2 text-xs text-white/70 flex items-center justify-between">
                  <span>â˜… {{ b.rating|default:"4.6" }}</span>
                  <span class="text-white/55">â€¢</span>
                  <span>{{ b.book_type|default:"free"|upper }}</span>
                </div>

                <div class="mt-3 flex gap-2">
                  <a href="{% url 'frontend:read' b.id 1 %}" class="flex-1 px-3 py-2 rounded-lg btn-red text-center text-sm font-semibold">Ler</a>
                  {% if user.is_authenticated %}
                    <a href="{% url 'frontend:favorites' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">â™¡</a>
                  {% else %}
                    <a href="{% url 'frontend:login' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">â™¡</a>
                  {% endif %}
                </div>
              </div>
            </article>
          {% empty %}
            <div class="text-white/60 text-sm">Sem recomendaÃ§Ãµes por enquanto.</div>
          {% endfor %}
        </div>
      </section>

      <section id="premium" class="pt-12">
        <div class="premium-strip p-6 sm:p-8 grid lg:grid-cols-2 gap-6 items-center">
          <div>
            <h3 class="text-2xl sm:text-3xl font-black">Seja Premium</h3>
            <p class="text-white/70 mt-2">
              Acesso ilimitado a livros Premium, progresso sincronizado e recomendaÃ§Ãµes avanÃ§adas.
            </p>
          </div>
          <div class="flex flex-col sm:flex-row gap-3 lg:justify-end">
            <a href="#" class="px-6 py-3 rounded-lg btn-red font-bold text-center">Assinar Agora</a>
            <a href="#todos" class="px-6 py-3 rounded-lg btn-ghost font-semibold text-center">Ver catÃ¡logo</a>
          </div>
        </div>
      </section>

      <section id="todos" class="pt-12">
        <div class="flex items-end justify-between gap-4">
          <div>
            <h2 class="text-xl sm:text-2xl font-black">Explorar</h2>
            <p class="text-sm text-white/60 mt-1">Todos os livros no banco.</p>
          </div>
        </div>

        <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-5 gap-4">
          {% for b in books %}
            <article class="rounded-2xl overflow-hidden border border-white/10 bg-white/5 hover:scale-[1.02] transition">
              <div class="h-44 bg-black/40 relative">
                {% if b.cover %}
                  <img src="{{ b.cover.url }}" alt="{{ b.title }}" class="w-full h-full object-cover">
                {% else %}
                  <div class="h-full grid place-items-center text-4xl">ğŸ“—</div>
                {% endif %}
                {% if b.book_type == "premium" %}
                  <span class="badge">ğŸ’ Premium</span>
                {% endif %}
              </div>

              <div class="p-3">
                <div class="font-bold text-sm clamp-2">{{ b.title }}</div>
                <div class="text-xs text-white/60 mt-1">
                  {{ b.author|default:"" }}{% if b.genre %} â€¢ {{ b.genre }}{% endif %}
                </div>

                <div class="mt-2 text-xs text-white/70 flex items-center justify-between">
                  <span>â˜… {{ b.rating|default:"4.6" }}</span>
                  <span>{{ b.book_type|default:"free"|upper }}</span>
                </div>

                <div class="mt-3 flex gap-2">
                  <a href="{% url 'frontend:read' b.id 1 %}" class="flex-1 px-3 py-2 rounded-lg btn-red text-center text-sm font-semibold">Ler</a>
                  {% if user.is_authenticated %}
                    <a href="{% url 'frontend:favorites' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">â™¡</a>
                  {% else %}
                    <a href="{% url 'frontend:login' %}" class="px-3 py-2 rounded-lg bg-white/10 border border-white/10 text-sm">â™¡</a>
                  {% endif %}
                </div>
              </div>
            </article>
          {% empty %}
            <div class="col-span-full text-white/60 text-sm">Nenhum livro encontrado.</div>
          {% endfor %}
        </div>
      </section>

      <footer class="pt-14 text-center text-xs text-white/40">
        Owlsight v1.0 â€” Todos direitos reservados
      </footer>
    </div>
  </main>

  <script>
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    if(menuBtn && mobileMenu){
      menuBtn.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));
    }
  </script>
</body>
</html>