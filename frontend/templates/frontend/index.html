{% load static %}
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Owlsight ‚Äî Biblioteca inteligente. Descubra, leia e organize livros com recomenda√ß√µes personalizadas." />
  <meta name="theme-color" content="#070707" />

  <link rel="icon" type="image/x-icon" href="{% static 'frontend/images/favicon.ico' %}">
  <link rel="apple-touch-icon" href="{% static 'frontend/images/favicon.ico' %}">
  <script src="https://cdn.tailwindcss.com"></script>

  <title>Owlsight ‚Äî Biblioteca</title>

  <style>
    :root{
      --bg:#070707;
      --panel: rgba(18,18,18,.78);
      --panel2: rgba(12,12,12,.92);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --red:#E10600;
      --red2:#8A0000;
      --green:#22c55e;
    }

    html,body{ height:100%; background: var(--bg); color: var(--text); }
    body{ overflow-x:hidden; }
    html { scroll-behavior: smooth; }

    /* Netflix-ish cinematic background + motion */
    .cinema-bg{
      background:
        radial-gradient(1200px 600px at 15% 0%, rgba(225,6,0,.22), transparent 60%),
        radial-gradient(1000px 520px at 85% 10%, rgba(138,0,0,.16), transparent 55%),
        radial-gradient(800px 520px at 50% 90%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.65)),
        var(--bg);
    }

    .grain:before{
      content:"";
      position:fixed; inset:-20%;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      opacity:.08;
      pointer-events:none;
      transform:translateZ(0);
      animation: grainMove 10s linear infinite;
    }
    @keyframes grainMove{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(-2%, 1%); }
      50%{ transform: translate(-1%, -2%); }
      75%{ transform: translate(2%, 1%); }
      100%{ transform: translate(0,0); }
    }

    .glass{
      background: rgba(255,255,255,.05);
      border: 1px solid var(--stroke);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .glow{
      box-shadow:
        0 0 0 1px rgba(255,255,255,.06),
        0 18px 60px rgba(0,0,0,.60),
        0 0 90px rgba(225,6,0,.12);
    }
    .pill{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
    }
    .u{ position:relative; }
    .u:after{
      content:"";
      position:absolute; left:0; bottom:-6px;
      width:0; height:2px;
      background: linear-gradient(90deg, var(--red), rgba(225,6,0,0));
      transition: width .25s ease;
    }
    .u:hover:after{ width:100%; }

    /* HERO spotlight animation */
    .spotlight{
      position:absolute; inset:-20%;
      background:
        radial-gradient(420px 240px at 30% 40%, rgba(225,6,0,.25), transparent 60%),
        radial-gradient(520px 320px at 70% 30%, rgba(138,0,0,.18), transparent 62%),
        radial-gradient(520px 340px at 55% 75%, rgba(255,255,255,.08), transparent 66%);
      filter: blur(1px);
      animation: drift 10s ease-in-out infinite;
      opacity: .9;
      pointer-events:none;
    }
    @keyframes drift{
      0%{ transform: translate(0,0) scale(1); }
      50%{ transform: translate(-1.5%, 1%) scale(1.02); }
      100%{ transform: translate(0,0) scale(1); }
    }

    /* Row scrolling */
    .row{
      display:flex;
      gap: .9rem;
      overflow-x:auto;
      padding-bottom: 10px;
      scroll-snap-type: x mandatory;
    }
    .row::-webkit-scrollbar{ height: 10px; }
    .row::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.10); border-radius: 999px; }
    .row::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); border-radius: 999px; }

    /* Card (Netflix-ish) */
    .card{
      width: 170px;
      flex: 0 0 auto;
      scroll-snap-align: start;
      transform: translateZ(0);
      transition: transform .18s ease, filter .18s ease;
    }
    @media (min-width: 640px){ .card{ width: 200px; } }
    @media (min-width: 1024px){ .card{ width: 220px; } }

    .card:hover{ transform: scale(1.06); z-index: 20; }
    .poster{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .overlay{
      opacity:0;
      transform: translateY(10px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .card:hover .overlay{
      opacity:1;
      transform: translateY(0);
    }
    .clamp-2{
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .clamp-3{
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    /* Modal preview */
    .modal-backdrop{ display:none; }
    .modal-backdrop.open{ display:block; }
    .modal-panel{
      transform: translateY(14px) scale(.98);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .modal-backdrop.open .modal-panel{
      transform: translateY(0) scale(1);
      opacity:1;
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>

<body id="top" class="cinema-bg grain">
  <!-- TOP NAV -->
  <header class="fixed top-0 left-0 right-0 z-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-4">
      <div class="glass glow rounded-2xl px-4 sm:px-5 py-3 flex items-center justify-between">
        <!-- Logo -->
        <a href="{% url 'frontend:home' %}" class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl glass grid place-items-center">
            <img src="{% static 'frontend/images/logo.png' %}" alt="Owlsight" class="w-7 h-7 object-contain"
                 onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;color:rgba(255,255,255,.9);font-weight:900;&quot;>O</span>';">
          </div>
          <div class="leading-tight">
            <div class="text-white font-black tracking-tight">Owlsight</div>
            <div class="text-xs" style="color:var(--muted2)">See beyond ‚Ä¢ biblioteca inteligente</div>
          </div>
        </a>

        <!-- Desktop menu -->
        <nav class="hidden md:flex items-center gap-6 text-sm">
          <a class="u" href="#catalogo">Cat√°logo</a>
          <a class="u" href="#mais-lidos">Mais lidos</a>
          <a class="u" href="#mais-recentes">Mais recentes</a>
          <a class="u" href="#todos">Todos</a>

          {% if user.is_authenticated %}
            <a class="u" href="{% url 'frontend:favorites' %}">Favoritos</a>
            <a class="u" href="{% url 'frontend:account' %}">Minha conta</a>
            {% if user.is_staff or user.is_superuser %}
              <a class="u" href="/admin/">Admin</a>
            {% endif %}
            <form method="post" action="{% url 'frontend:logout' %}" class="inline">
              {% csrf_token %}
              <button class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Sair</button>
            </form>
          {% else %}
            <a class="u" href="{% url 'frontend:categories' %}">Categorias</a>
            <a class="u" href="{% url 'frontend:login' %}">Login</a>
            <a href="{% url 'frontend:register' %}"
               class="px-3 py-2 rounded-xl text-sm font-semibold"
               style="background:linear-gradient(135deg,var(--red),var(--red2));">
              Criar conta
            </a>
          {% endif %}
        </nav>

        <!-- Mobile menu button -->
        <button id="menuBtn" class="md:hidden px-3 py-2 rounded-xl pill hover:bg-white/10 transition">
          <span class="sr-only">Abrir menu</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zm0 5.25A.75.75 0 013.75 11.25h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25A.75.75 0 013.75 16.5h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 17.25z" clip-rule="evenodd"/>
          </svg>
        </button>
      </div>

      <!-- Mobile dropdown -->
      <div id="mobileMenu" class="hidden mt-3 glass glow rounded-2xl p-4 md:hidden">
        <div class="grid gap-2 text-sm">
          <a href="#catalogo" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Cat√°logo</a>
          <a href="#mais-lidos" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Mais lidos</a>
          <a href="#mais-recentes" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Mais recentes</a>
          <a href="#todos" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Todos</a>

          {% if user.is_authenticated %}
            <a href="{% url 'frontend:favorites' %}" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Favoritos</a>
            <a href="{% url 'frontend:account' %}" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Minha conta</a>
            {% if user.is_staff or user.is_superuser %}
              <a href="/admin/" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Admin</a>
            {% endif %}
            <form method="post" action="{% url 'frontend:logout' %}">
              {% csrf_token %}
              <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Sair</button>
            </form>
          {% else %}
            <a href="{% url 'frontend:categories' %}" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Categorias</a>
            <a href="{% url 'frontend:login' %}" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition">Login</a>
            <a href="{% url 'frontend:register' %}"
               class="px-3 py-2 rounded-xl text-sm font-semibold text-center"
               style="background:linear-gradient(135deg,var(--red),var(--red2));">
              Criar conta
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- HERO (Netflix style: simples, vivo, sem quadros feios) -->
  <main class="pt-28">
    <section class="relative">
      <div class="absolute inset-0 overflow-hidden">
        <div class="spotlight"></div>
        <!-- bottom fade like Netflix -->
        <div class="absolute inset-0"
             style="background:linear-gradient(90deg, rgba(7,7,7,.92) 0%, rgba(7,7,7,.55) 45%, rgba(7,7,7,.25) 100%);"></div>
        <div class="absolute inset-x-0 bottom-0 h-40"
             style="background:linear-gradient(180deg, transparent, rgba(7,7,7,1));"></div>
      </div>

      <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
        {% if messages %}
          <div class="mb-6 grid gap-2">
            {% for message in messages %}
              <div class="glass rounded-2xl px-4 py-3 border border-white/10">
                <div class="text-sm">
                  <span class="font-semibold">{{ message.tags|default:"info"|upper }}</span>
                  <span class="text-white/80"> ‚Äî {{ message }}</span>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <div class="grid lg:grid-cols-12 gap-8 items-center">
          <!-- Text -->
          <div class="lg:col-span-7">
            <div class="inline-flex items-center gap-2 text-xs">
              <span class="px-3 py-1 rounded-full pill">üé¨ Cinematic</span>
              <span class="px-3 py-1 rounded-full pill">üìö Biblioteca</span>
              <span class="px-3 py-1 rounded-full pill">‚ö° R√°pido</span>
            </div>

            <h1 class="mt-5 text-4xl sm:text-5xl lg:text-6xl font-black tracking-tight">
              Owlsight
              <span style="color:var(--red)">Netflix-style</span>
              para livros.
            </h1>

            <p class="mt-4 text-white/70 text-base sm:text-lg max-w-2xl">
              Scroll horizontal, hover com descri√ß√£o e preview ‚Äî tudo puxado do banco.
              {% if not db_books_count %}
                <span class="text-white/60">Adicione livros no Admin para come√ßar.</span>
              {% endif %}
            </p>

            <!-- Search mini bar -->
            <form method="get" action="#todos" class="mt-6 flex flex-col sm:flex-row gap-3 max-w-2xl">
              <div class="flex-1 glass rounded-2xl px-4 py-3 border border-white/10">
                <input name="q" value="{{ request.GET.q|default:'' }}"
                       placeholder="Pesquisar por t√≠tulo, autor, g√©nero..."
                       class="w-full bg-transparent outline-none text-sm placeholder:text-white/40"/>
              </div>

              <div class="sm:w-52 glass rounded-2xl px-4 py-3 border border-white/10">
                <select name="type" class="w-full bg-transparent outline-none text-sm">
                  <option value="">Todos</option>
                  <option value="free" {% if request.GET.type == "free" %}selected{% endif %}>Free</option>
                  <option value="premium" {% if request.GET.type == "premium" %}selected{% endif %}>Premium</option>
                </select>
              </div>

              <button type="submit"
                      class="px-5 py-3 rounded-2xl font-bold text-center"
                      style="background:linear-gradient(135deg,var(--red),var(--red2));">
                Buscar
              </button>
            </form>

            <!-- Featured actions -->
            <div class="mt-6 flex flex-wrap gap-3">
              <a href="#catalogo"
                 class="px-5 py-3 rounded-2xl font-bold"
                 style="background:linear-gradient(135deg,var(--red),var(--red2));">
                Explorar agora
              </a>

              {% if featured %}
                <a href="{% url 'frontend:read' featured.id 1 %}"
                   class="px-5 py-3 rounded-2xl font-semibold pill hover:bg-white/10 transition">
                  ‚ñ∂ Ler destaque
                </a>

                <button type="button"
                        class="px-5 py-3 rounded-2xl font-semibold pill hover:bg-white/10 transition"
                        data-open-preview="1"
                        data-id="{{ featured.id }}"
                        data-title="{{ featured.title|escape }}"
                        data-author="{{ featured.author|default:''|escape }}"
                        data-genre="{{ featured.genre|default:''|escape }}"
                        data-type="{{ featured.book_type|escape }}"
                        data-pages="{{ featured.total_pages|default:'' }}"
                        data-desc="{{ featured.description|default:''|striptags|escape }}"
                        data-cover="{% if featured.cover %}{{ featured.cover.url }}{% else %}{% endif %}">
                  ‚ìò Mais info
                </button>
              {% else %}
                <a href="/admin/"
                   class="px-5 py-3 rounded-2xl font-semibold pill hover:bg-white/10 transition">
                  Abrir Admin
                </a>
              {% endif %}
            </div>

            <div class="mt-4 text-xs text-white/45">
              Livros no banco: {{ db_books_count|default:"0" }}
            </div>
          </div>

          <!-- Featured poster (right) -->
          <div class="lg:col-span-5">
            <div class="relative rounded-3xl overflow-hidden glow border border-white/10">
              <div class="absolute inset-0"
                   style="background:linear-gradient(135deg, rgba(225,6,0,.18), rgba(0,0,0,.0));"></div>

              {% if featured and featured.cover %}
                <img src="{{ featured.cover.url }}" alt="{{ featured.title }}"
                     class="w-full h-[420px] object-cover" />
              {% else %}
                <div class="w-full h-[420px] bg-white/5 grid place-items-center">
                  <div class="text-center">
                    <div class="text-6xl">üìï</div>
                    <div class="mt-2 text-sm text-white/60">Sem capa (por enquanto)</div>
                  </div>
                </div>
              {% endif %}

              <div class="absolute inset-x-0 bottom-0 p-5"
                   style="background:linear-gradient(180deg, transparent, rgba(0,0,0,.88));">
                {% if featured %}
                  <div class="text-sm text-white/70">Destaque</div>
                  <div class="text-2xl font-black">{{ featured.title }}</div>
                  <div class="text-sm text-white/60 mt-1">
                    {{ featured.author|default:"" }}
                    {% if featured.genre %} ‚Ä¢ {{ featured.genre }}{% endif %}
                    ‚Ä¢ {% if featured.book_type == "premium" %}üíé Premium{% else %}üéÅ Free{% endif %}
                  </div>
                  <p class="mt-2 text-sm text-white/70 clamp-2">{{ featured.description|default:"‚Äî" }}</p>
                {% else %}
                  <div class="text-sm text-white/70">Destaque</div>
                  <div class="text-2xl font-black">Adicione livros no Admin</div>
                  <div class="text-sm text-white/60 mt-1">Para a hero ficar viva com dados reais.</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CATALOG ROWS (Netflix horizontal rows) -->
    <section id="catalogo" class="py-10">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex items-end justify-between gap-4">
          <div>
            <h2 class="text-2xl sm:text-3xl font-black">Cat√°logo</h2>
            <p class="text-white/60 mt-1 text-sm">Passe o mouse e veja a descri√ß√£o. Clique para abrir o preview.</p>
          </div>
          <a href="#todos" class="text-sm text-white/60 hover:text-white transition">Ver todos ‚Üí</a>
        </div>

        <!-- Row: Mais lidos -->
        <div id="mais-lidos" class="mt-7">
          <div class="flex items-center justify-between">
            <h3 class="text-lg sm:text-xl font-black">Mais lidos</h3>
            <a href="#todos" class="text-xs text-white/55 hover:text-white transition">Ir para resultados</a>
          </div>

          <div class="row mt-4">
            {% for b in most_read %}
              <article class="card group">
                <div class="relative rounded-2xl overflow-hidden poster">
                  {% if b.cover %}
                    <img src="{{ b.cover.url }}" alt="{{ b.title }}"
                         class="w-full h-[250px] object-cover" />
                  {% else %}
                    <div class="w-full h-[250px] bg-white/5 grid place-items-center">üìò</div>
                  {% endif %}

                  <!-- hover overlay -->
                  <div class="overlay absolute inset-0 p-3 flex flex-col justify-end"
                       style="background:linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.92));">
                    <div class="text-sm font-extrabold leading-tight clamp-2">{{ b.title }}</div>
                    <div class="text-xs text-white/70 mt-1">
                      {{ b.author|default:"" }}{% if b.genre %} ‚Ä¢ {{ b.genre }}{% endif %}
                    </div>
                    <div class="mt-2 flex flex-wrap gap-2 text-[11px]">
                      <span class="px-2 py-1 rounded-full pill">
                        {% if b.book_type == "premium" %}üíé Premium{% else %}üéÅ Free{% endif %}
                      </span>
                      {% if b.total_pages %}
                        <span class="px-2 py-1 rounded-full pill">üìñ {{ b.total_pages }}p</span>
                      {% endif %}
                    </div>

                    <p class="mt-2 text-xs text-white/70 clamp-3">
                      {{ b.description|default:""|truncatechars:140 }}
                    </p>

                    <div class="mt-3 flex gap-2">
                      <a href="{% url 'frontend:read' b.id 1 %}"
                         class="flex-1 text-center px-3 py-2 rounded-xl font-semibold"
                         style="background:linear-gradient(135deg,var(--red),var(--red2));">
                        Ler
                      </a>
                      <button type="button"
                              class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition"
                              data-open-preview="1"
                              data-id="{{ b.id }}"
                              data-title="{{ b.title|escape }}"
                              data-author="{{ b.author|default:''|escape }}"
                              data-genre="{{ b.genre|default:''|escape }}"
                              data-type="{{ b.book_type|escape }}"
                              data-pages="{{ b.total_pages|default:'' }}"
                              data-desc="{{ b.description|default:''|striptags|escape }}"
                              data-cover="{% if b.cover %}{{ b.cover.url }}{% else %}{% endif %}">
                        ‚ìò
                      </button>
                    </div>
                  </div>
                </div>
              </article>
            {% empty %}
              <div class="glass rounded-2xl p-5 text-sm text-white/60 border border-white/10">
                Ainda n√£o h√° livros no banco.
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- Row: Mais recentes -->
        <div id="mais-recentes" class="mt-10">
          <div class="flex items-center justify-between">
            <h3 class="text-lg sm:text-xl font-black">Mais recentes</h3>
            <a href="#todos" class="text-xs text-white/55 hover:text-white transition">Ir para resultados</a>
          </div>

          <div class="row mt-4">
            {% for b in most_recent %}
              <article class="card group">
                <div class="relative rounded-2xl overflow-hidden poster">
                  {% if b.cover %}
                    <img src="{{ b.cover.url }}" alt="{{ b.title }}"
                         class="w-full h-[250px] object-cover" />
                  {% else %}
                    <div class="w-full h-[250px] bg-white/5 grid place-items-center">üÜï</div>
                  {% endif %}

                  <div class="overlay absolute inset-0 p-3 flex flex-col justify-end"
                       style="background:linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.92));">
                    <div class="text-sm font-extrabold leading-tight clamp-2">{{ b.title }}</div>
                    <div class="text-xs text-white/70 mt-1">
                      {{ b.author|default:"" }}{% if b.genre %} ‚Ä¢ {{ b.genre }}{% endif %}
                    </div>

                    <div class="mt-2 flex flex-wrap gap-2 text-[11px]">
                      <span class="px-2 py-1 rounded-full pill">
                        {% if b.book_type == "premium" %}üíé Premium{% else %}üéÅ Free{% endif %}
                      </span>
                      {% if b.total_pages %}
                        <span class="px-2 py-1 rounded-full pill">üìñ {{ b.total_pages }}p</span>
                      {% endif %}
                    </div>

                    <p class="mt-2 text-xs text-white/70 clamp-3">
                      {{ b.description|default:""|truncatechars:140 }}
                    </p>

                    <div class="mt-3 flex gap-2">
                      <a href="{% url 'frontend:read' b.id 1 %}"
                         class="flex-1 text-center px-3 py-2 rounded-xl font-semibold"
                         style="background:linear-gradient(135deg,var(--red),var(--red2));">
                        Ler
                      </a>
                      <button type="button"
                              class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition"
                              data-open-preview="1"
                              data-id="{{ b.id }}"
                              data-title="{{ b.title|escape }}"
                              data-author="{{ b.author|default:''|escape }}"
                              data-genre="{{ b.genre|default:''|escape }}"
                              data-type="{{ b.book_type|escape }}"
                              data-pages="{{ b.total_pages|default:'' }}"
                              data-desc="{{ b.description|default:''|striptags|escape }}"
                              data-cover="{% if b.cover %}{{ b.cover.url }}{% else %}{% endif %}">
                        ‚ìò
                      </button>
                    </div>
                  </div>
                </div>
              </article>
            {% empty %}
              <div class="glass rounded-2xl p-5 text-sm text-white/60 border border-white/10">
                Sem livros recentes ainda.
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <!-- ALL RESULTS (grid) -->
    <section id="todos" class="py-10">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex items-end justify-between gap-4">
          <div>
            <h3 class="text-xl sm:text-2xl font-black">Resultados</h3>
            <p class="text-white/60 text-sm mt-1">Cat√°logo completo (DB).</p>
          </div>

          <form method="get" action="#todos" class="hidden sm:flex items-center gap-2">
            <select name="sort" class="px-3 py-2 rounded-xl pill text-sm bg-transparent">
              <option value="recentes" {% if request.GET.sort == "recentes" %}selected{% endif %}>Recentes</option>
              <option value="antigos" {% if request.GET.sort == "antigos" %}selected{% endif %}>Antigos</option>
              <option value="titulo" {% if request.GET.sort == "titulo" %}selected{% endif %}>T√≠tulo</option>
            </select>
            <button class="px-4 py-2 rounded-xl text-sm font-semibold"
                    style="background:linear-gradient(135deg,var(--red),var(--red2));">
              Ordenar
            </button>
          </form>
        </div>

        <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-5 gap-4">
          {% for b in books %}
            <article class="group rounded-2xl overflow-hidden poster hover:scale-[1.02] transition will-change-transform">
              <div class="relative">
                {% if b.cover %}
                  <img src="{{ b.cover.url }}" alt="{{ b.title }}" class="h-40 w-full object-cover" />
                {% else %}
                  <div class="h-40 bg-white/5 grid place-items-center">üìó</div>
                {% endif %}

                <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition"
                     style="background:linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.92));"></div>

                <div class="absolute inset-x-0 bottom-0 p-3 opacity-0 group-hover:opacity-100 transition">
                  <div class="text-sm font-extrabold clamp-2">{{ b.title }}</div>
                  <div class="text-xs text-white/70 mt-1">
                    {{ b.author|default:"" }}{% if b.genre %} ‚Ä¢ {{ b.genre }}{% endif %}
                  </div>
                  <p class="mt-2 text-xs text-white/70 clamp-2">{{ b.description|default:""|truncatechars:120 }}</p>
                  <div class="mt-3 flex gap-2">
                    <a href="{% url 'frontend:read' b.id 1 %}"
                       class="flex-1 text-center px-3 py-2 rounded-xl font-semibold"
                       style="background:linear-gradient(135deg,var(--red),var(--red2));">
                      Ler
                    </a>
                    <button type="button"
                            class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition"
                            data-open-preview="1"
                            data-id="{{ b.id }}"
                            data-title="{{ b.title|escape }}"
                            data-author="{{ b.author|default:''|escape }}"
                            data-genre="{{ b.genre|default:''|escape }}"
                            data-type="{{ b.book_type|escape }}"
                            data-pages="{{ b.total_pages|default:'' }}"
                            data-desc="{{ b.description|default:''|striptags|escape }}"
                            data-cover="{% if b.cover %}{{ b.cover.url }}{% else %}{% endif %}">
                      ‚ìò
                    </button>
                  </div>
                </div>
              </div>
            </article>
          {% empty %}
            <div class="col-span-full glass glow rounded-2xl p-5 text-sm text-white/60 border border-white/10">
              Nenhum livro encontrado.
            </div>
          {% endfor %}
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="py-10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="glass glow rounded-2xl p-5 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div class="text-sm text-white/70">
          <div class="font-semibold">Owlsight v1.0 ‚Äî Todos direitos reservados</div>
          <div class="text-xs text-white/45 mt-1">
            Ao usar a plataforma, voc√™ concorda com os termos e condi√ß√µes aplic√°veis.
          </div>
        </div>
        <div class="flex flex-wrap gap-2">
          <a href="{% url 'frontend:terms' %}" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition text-sm">Termos</a>
          <a href="{% url 'frontend:privacy' %}" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition text-sm">Privacidade</a>
          <a href="#top" class="px-3 py-2 rounded-xl pill hover:bg-white/10 transition text-sm">Topo ‚Üë</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- PREVIEW MODAL (Netflix ‚ÄúMore Info‚Äù) -->
  <div id="previewModal" class="modal-backdrop fixed inset-0 z-[80]">
    <div class="absolute inset-0 bg-black/75"></div>

    <div class="relative mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-10">
      <div class="modal-panel glass glow rounded-3xl overflow-hidden border border-white/10">
        <div class="relative">
          <div id="pmCoverWrap" class="h-[260px] sm:h-[320px] bg-white/5">
            <img id="pmCover" src="" alt="" class="w-full h-full object-cover hidden">
            <div id="pmNoCover" class="w-full h-full grid place-items-center text-5xl">üìï</div>
          </div>

          <div class="absolute inset-0"
               style="background:linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.92));"></div>

          <button id="pmClose" class="absolute top-3 right-3 px-3 py-2 rounded-xl pill hover:bg-white/10 transition">
            ‚úï
          </button>

          <div class="absolute inset-x-0 bottom-0 p-5">
            <div id="pmTitle" class="text-2xl sm:text-3xl font-black"></div>
            <div id="pmMeta" class="text-sm text-white/70 mt-1"></div>
          </div>
        </div>

        <div class="p-5 sm:p-6">
          <div class="flex flex-wrap gap-2">
            <span id="pmType" class="px-3 py-1 rounded-full pill text-xs"></span>
            <span id="pmPages" class="px-3 py-1 rounded-full pill text-xs hidden"></span>
          </div>

          <p id="pmDesc" class="mt-4 text-sm text-white/70 leading-relaxed"></p>

          <div class="mt-5 flex flex-col sm:flex-row gap-3">
            <a id="pmRead" href="#" class="px-5 py-3 rounded-2xl font-bold text-center"
               style="background:linear-gradient(135deg,var(--red),var(--red2));">
              Ler agora
            </a>
            <a href="{% url 'frontend:login' %}" class="px-5 py-3 rounded-2xl font-semibold text-center pill hover:bg-white/10 transition">
              Favoritar (login)
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mobile menu
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    if(menuBtn && mobileMenu){
      menuBtn.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));
    }

    // Modal preview
    const modal = document.getElementById("previewModal");
    const pmClose = document.getElementById("pmClose");
    const pmCover = document.getElementById("pmCover");
    const pmNoCover = document.getElementById("pmNoCover");
    const pmTitle = document.getElementById("pmTitle");
    const pmMeta = document.getElementById("pmMeta");
    const pmDesc = document.getElementById("pmDesc");
    const pmType = document.getElementById("pmType");
    const pmPages = document.getElementById("pmPages");
    const pmRead = document.getElementById("pmRead");

    function openModalFromBtn(btn){
      const id = btn.getAttribute("data-id");
      const title = btn.getAttribute("data-title") || "Livro";
      const author = btn.getAttribute("data-author") || "";
      const genre = btn.getAttribute("data-genre") || "";
      const type = btn.getAttribute("data-type") || "";
      const pages = btn.getAttribute("data-pages") || "";
      const desc = btn.getAttribute("data-desc") || "";
      const cover = btn.getAttribute("data-cover") || "";

      pmTitle.textContent = title;
      pmMeta.textContent = [author, genre].filter(Boolean).join(" ‚Ä¢ ");

      pmDesc.textContent = desc || "Sem descri√ß√£o.";
      pmType.textContent = (type === "premium") ? "üíé Premium" : "üéÅ Free";

      if(pages){
        pmPages.classList.remove("hidden");
        pmPages.textContent = "üìñ " + pages + " p√°ginas";
      }else{
        pmPages.classList.add("hidden");
        pmPages.textContent = "";
      }

      // cover
      if(cover){
        pmCover.src = cover;
        pmCover.alt = title;
        pmCover.classList.remove("hidden");
        pmNoCover.classList.add("hidden");
      }else{
        pmCover.src = "";
        pmCover.classList.add("hidden");
        pmNoCover.classList.remove("hidden");
      }

      // read link (mant√©m teu padr√£o /read/<id>/1/)
      pmRead.href = "/read/" + id + "/1/";

      modal.classList.add("open");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      modal.classList.remove("open");
      document.body.style.overflow = "";
    }

    document.querySelectorAll("[data-open-preview='1']").forEach(btn => {
      btn.addEventListener("click", () => openModalFromBtn(btn));
    });

    pmClose.addEventListener("click", closeModal);
    modal.addEventListener("click", (e) => {
      // click fora do painel fecha
      if(e.target === modal || e.target.classList.contains("bg-black/75")) closeModal();
    });

    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape" && modal.classList.contains("open")) closeModal();
    });
  </script>
</body>
</html>